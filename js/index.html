<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
            <title>ГІП-Проектувальник v2.8</title>
                <style>
                        body { margin: 0; background: #111; overflow: hidden; font-family: monospace; touch-action: none; }
                                #ui { position: absolute; top: 10px; left: 10px; color: #0f0; background: rgba(0,0,0,0.8); padding: 10px; border: 1px solid #0f0; pointer-events: none; font-size: 11px; z-index: 100; }
                                        #coords { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); color: #ff0; background: rgba(0,0,0,0.9); padding: 12px; border: 2px solid #ff0; font-size: 13px; text-align: center; width: 90%; border-radius: 8px; z-index: 100; }
                                                .controls-hint { position: absolute; top: 70px; left: 10px; color: #fff; background: #333; padding: 5px; font-size: 10px; border-radius: 4px; }
                                                    </style>
                                                    </head>
                                                    <body>
                                                        <div id="ui">РЕЖИМ ГІП: ПРОЕКТУВАННЯ v2.8<br>Натисніть на об'єкт, щоб з'явилися стрілки</div>
                                                            <div class="controls-hint">W: Рух | S: Розмір (Scale) | R: Поворот</div>
                                                                <div id="coords">Оберіть перестінок для редагування...</div>

                                                                    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
                                                                        
                                                                            <script type="module">
                                                                                    import { createArchitecture } from './js/architecture.js';
                                                                                            import { createPlumbing } from './js/engineering.js';
                                                                                                    import { TransformControls } from 'https://cdn.skypack.dev/three@0.128.0/examples/jsm/controls/TransformControls.js';
                                                                                                            import { OrbitControls } from 'https://cdn.skypack.dev/three@0.128.0/examples/jsm/controls/OrbitControls.js';

                                                                                                                    const scene = new THREE.Scene();
                                                                                                                            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                                                                                                                                    const renderer = new THREE.WebGLRenderer({ antialias: true });
                                                                                                                                            renderer.setSize(window.innerWidth, window.innerHeight);
                                                                                                                                                    document.body.appendChild(renderer.domElement);

                                                                                                                                                            scene.add(new THREE.GridHelper(20, 20, 0x444444, 0x222222));
                                                                                                                                                                    scene.add(new THREE.AmbientLight(0xffffff, 1));

                                                                                                                                                                            camera.position.set(5, 5, 5);
                                                                                                                                                                                    const orbit = new OrbitControls(camera, renderer.domElement);

                                                                                                                                                                                            // Маніпулятор
                                                                                                                                                                                                    const transformControl = new TransformControls(camera, renderer.domElement);
                                                                                                                                                                                                            scene.add(transformControl);

                                                                                                                                                                                                                    transformControl.addEventListener('dragging-changed', function (event) {
                                                                                                                                                                                                                                orbit.enabled = !event.value;
                                                                                                                                                                                                                                        });

                                                                                                                                                                                                                                                // Завантаження архітектури
                                                                                                                                                                                                                                                        createArchitecture(scene);
                                                                                                                                                                                                                                                                createPlumbing(scene);

                                                                                                                                                                                                                                                                        // Логіка вибору об'єкта
                                                                                                                                                                                                                                                                                const raycaster = new THREE.Raycaster();
                                                                                                                                                                                                                                                                                        const mouse = new THREE.Vector2();

                                                                                                                                                                                                                                                                                                window.addEventListener('pointerdown', (event) => {
                                                                                                                                                                                                                                                                                                            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                                                                                                                                                                                                                                                                                                                        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
                                                                                                                                                                                                                                                                                                                                    raycaster.setFromCamera(mouse, camera);
                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                            const intersects = raycaster.intersectObjects(scene.children, true);
                                                                                                                                                                                                                                                                                                                                                                        if (intersects.length > 0) {
                                                                                                                                                                                                                                                                                                                                                                                        const object = intersects[0].object;
                                                                                                                                                                                                                                                                                                                                                                                                        if (object.isMesh && object.geometry.type === 'BoxGeometry') {
                                                                                                                                                                                                                                                                                                                                                                                                                            transformControl.attach(object);
                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Вивід координат
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const coordsDisplay = document.getElementById('coords');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        transformControl.addEventListener('objectChange', function () {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const obj = transformControl.object;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                coordsDisplay.innerHTML = `ПОЗИЦІЯ: X:${obj.position.x.toFixed(2)} Z:${obj.position.z.toFixed(2)}<br>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            РОЗМІР (Scale): X:${obj.scale.x.toFixed(2)} Z:${obj.scale.z.toFixed(2)}<br>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ПОВОРОТ: ${obj.rotation.y.toFixed(2)} рад.`;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // Гарячі клавіші для планшетної клавіатури (опціонально)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                window.addEventListener('keydown', function (event) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            switch (event.key) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            case 'w': transformControl.setMode('translate'); break; // Рух
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            case 's': transformControl.setMode('scale'); break;     // Масштаб
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            case 'r': transformControl.setMode('rotate'); break;    // Поворот
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        function animate() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    requestAnimationFrame(animate);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                renderer.render(scene, camera);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                animate();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    