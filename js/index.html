<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
            <title>Модуль-Миколаїв: КОНСТРУКТОР</title>
                <style>
                        body { margin: 0; background: #111; overflow: hidden; font-family: monospace; touch-action: none; }
                                #ui { position: absolute; top: 10px; left: 10px; color: #0f0; background: rgba(0,0,0,0.8); padding: 10px; border: 1px solid #0f0; pointer-events: none; font-size: 11px; z-index: 10; }
                                        #coords { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); color: #ff0; background: rgba(0,0,0,0.9); padding: 12px; border: 2px solid #ff0; font-size: 14px; text-align: center; width: 90%; border-radius: 8px; z-index: 10; line-height: 1.4; }
                                            </style>
                                            </head>
                                            <body>
                                                <div id="ui">РЕЖИМ ГІП: РУХАЙТЕ ПЕРЕСТІНКИ ПАЛЬЦЕМ<br>1 палець: обертання | 2 пальці: зум</div>
                                                    <div id="coords">Торкніться стіни, щоб побачити координати...</div>

                                                        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
                                                            
                                                                <script type="module">
                                                                        import { createArchitecture } from './js/architecture.js';
                                                                                import { createPlumbing } from './js/engineering.js';
                                                                                        import { createEnergy } from './js/energy.js';
                                                                                                import { DragControls } from 'https://cdn.skypack.dev/three@0.128.0/examples/jsm/controls/DragControls.js';
                                                                                                        import { OrbitControls } from 'https://cdn.skypack.dev/three@0.128.0/examples/jsm/controls/OrbitControls.js';

                                                                                                                const scene = new THREE.Scene();
                                                                                                                        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                                                                                                                                const renderer = new THREE.WebGLRenderer({ antialias: true });
                                                                                                                                        renderer.setSize(window.innerWidth, window.innerHeight);
                                                                                                                                                renderer.setPixelRatio(window.devicePixelRatio);
                                                                                                                                                        document.body.appendChild(renderer.domElement);

                                                                                                                                                                scene.add(new THREE.GridHelper(20, 20, 0x444444, 0x222222));
                                                                                                                                                                        scene.add(new THREE.AmbientLight(0xffffff, 0.9));
                                                                                                                                                                                
                                                                                                                                                                                        const light = new THREE.PointLight(0xffffff, 0.5);
                                                                                                                                                                                                light.position.set(5, 10, 5);
                                                                                                                                                                                                        scene.add(light);

                                                                                                                                                                                                                camera.position.set(5, 7, 5);
                                                                                                                                                                                                                        camera.lookAt(0, 0, 0);

                                                                                                                                                                                                                                // Створюємо об'єкти
                                                                                                                                                                                                                                        createArchitecture(scene);
                                                                                                                                                                                                                                                createPlumbing(scene);
                                                                                                                                                                                                                                                        createEnergy(scene);

                                                                                                                                                                                                                                                                // Дозволяємо перетягувати ВСЕ (стіни, бак, панелі)
                                                                                                                                                                                                                                                                        const draggableObjects = [];
                                                                                                                                                                                                                                                                                scene.traverse((child) => {
                                                                                                                                                                                                                                                                                            if (child.isMesh) draggableObjects.push(child);
                                                                                                                                                                                                                                                                                                    });

                                                                                                                                                                                                                                                                                                            const orbit = new OrbitControls(camera, renderer.domElement);
                                                                                                                                                                                                                                                                                                                    orbit.enableDamping = true;

                                                                                                                                                                                                                                                                                                                            const drag = new DragControls(draggableObjects, camera, renderer.domElement);
                                                                                                                                                                                                                                                                                                                                    const coordsDisplay = document.getElementById('coords');

                                                                                                                                                                                                                                                                                                                                            drag.addEventListener('dragstart', function (event) {
                                                                                                                                                                                                                                                                                                                                                        orbit.enabled = false;
                                                                                                                                                                                                                                                                                                                                                                    event.object.material.emissive ? event.object.material.emissive.set(0x333333) : null;
                                                                                                                                                                                                                                                                                                                                                                            });

                                                                                                                                                                                                                                                                                                                                                                                    drag.addEventListener('dragend', function (event) {
                                                                                                                                                                                                                                                                                                                                                                                                orbit.enabled = true;
                                                                                                                                                                                                                                                                                                                                                                                                            event.object.material.emissive ? event.object.material.emissive.set(0x000000) : null;
                                                                                                                                                                                                                                                                                                                                                                                                                    });

                                                                                                                                                                                                                                                                                                                                                                                                                            drag.addEventListener('drag', function (event) {
                                                                                                                                                                                                                                                                                                                                                                                                                                        const p = event.object.position;
                                                                                                                                                                                                                                                                                                                                                                                                                                                    const r = event.object.rotation.y;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                coordsDisplay.innerHTML = `ОБ'ЄКТ: ${event.object.geometry.type}<br>X: ${p.x.toFixed(2)} | Y: ${p.y.toFixed(2)} | Z: ${p.z.toFixed(2)} | RotY: ${r.toFixed(2)}`;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                function animate() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            requestAnimationFrame(animate);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        orbit.update();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    renderer.render(scene, camera);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    animate();

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            window.addEventListener('resize', () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        camera.aspect = window.innerWidth / window.innerHeight;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    camera.updateProjectionMatrix();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                renderer.setSize(window.innerWidth, window.innerHeight);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            