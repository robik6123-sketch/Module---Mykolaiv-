<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
            <title>Модуль-Миколаїв: Touch Control</title>
                <style>
                        body { margin: 0; background: #111; overflow: hidden; font-family: monospace; touch-action: none; }
                                #ui { position: absolute; top: 10px; left: 10px; color: #0f0; background: rgba(0,0,0,0.8); padding: 10px; border: 1px solid #0f0; pointer-events: none; font-size: 12px; }
                                        #coords { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); color: #ff0; background: rgba(0,0,0,0.9); padding: 15px; border: 2px solid #ff0; font-size: 16px; text-align: center; width: 80%; border-radius: 10px; }
                                            </style>
                                            </head>
                                            <body>
                                                <div id="ui">ГІП: КОНТРОЛЬ ОБ'ЄКТІВ<br>Торкніться та тягніть бак або бойлер</div>
                                                    <div id="coords">Координати v2.16:<br>Оберіть об'єкт</div>

                                                        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
                                                            
                                                                <script type="module">
                                                                        import { createArchitecture } from './js/architecture.js';
                                                                                import { createPlumbing } from './js/engineering.js';
                                                                                        import { DragControls } from 'https://cdn.skypack.dev/three@0.128.0/examples/jsm/controls/DragControls.js';

                                                                                                const scene = new THREE.Scene();
                                                                                                        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                                                                                                                const renderer = new THREE.WebGLRenderer({ antialias: true });
                                                                                                                        renderer.setSize(window.innerWidth, window.innerHeight);
                                                                                                                                renderer.setPixelRatio(window.devicePixelRatio);
                                                                                                                                        document.body.appendChild(renderer.domElement);

                                                                                                                                                scene.add(new THREE.AmbientLight(0xffffff, 1.0));
                                                                                                                                                        camera.position.set(6, 5, 8);
                                                                                                                                                                camera.lookAt(0, 1, 0);

                                                                                                                                                                        const draggableObjects = [];
                                                                                                                                                                                createArchitecture(scene);
                                                                                                                                                                                        createPlumbing(scene);

                                                                                                                                                                                                // Збираємо об'єкти для перетягування (ігноруємо велику коробку будівлі)
                                                                                                                                                                                                        scene.traverse((child) => {
                                                                                                                                                                                                                    if (child.isMesh && child.geometry.type !== 'BoxGeometry') {
                                                                                                                                                                                                                                    draggableObjects.push(child);
                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                        });

                                                                                                                                                                                                                                                                const controls = new DragControls(draggableObjects, camera, renderer.domElement);
                                                                                                                                                                                                                                                                        const coordsDisplay = document.getElementById('coords');

                                                                                                                                                                                                                                                                                // Події для тач-скріна
                                                                                                                                                                                                                                                                                        controls.addEventListener('dragstart', function (event) {
                                                                                                                                                                                                                                                                                                    event.object.material.emissive.set(0x333333); // Підсвічуємо при дотику
                                                                                                                                                                                                                                                                                                            });

                                                                                                                                                                                                                                                                                                                    controls.addEventListener('drag', function (event) {
                                                                                                                                                                                                                                                                                                                                const pos = event.object.position;
                                                                                                                                                                                                                                                                                                                                            coordsDisplay.innerHTML = `ПОЗИЦІЯ ДЛЯ v2.16:<br>X: ${pos.x.toFixed(2)} | Y: ${pos.y.toFixed(2)} | Z: ${pos.z.toFixed(2)}`;
                                                                                                                                                                                                                                                                                                                                                        renderer.render(scene, camera);
                                                                                                                                                                                                                                                                                                                                                                });

                                                                                                                                                                                                                                                                                                                                                                        controls.addEventListener('dragend', function (event) {
                                                                                                                                                                                                                                                                                                                                                                                    event.object.material.emissive.set(0x000000); // Гасимо підсвітку
                                                                                                                                                                                                                                                                                                                                                                                            });

                                                                                                                                                                                                                                                                                                                                                                                                    function animate() {
                                                                                                                                                                                                                                                                                                                                                                                                                requestAnimationFrame(animate);
                                                                                                                                                                                                                                                                                                                                                                                                                            renderer.render(scene, camera);
                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                            animate();

                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Авто-корекція при повороті планшета
                                                                                                                                                                                                                                                                                                                                                                                                                                                            window.addEventListener('resize', () => {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        camera.aspect = window.innerWidth / window.innerHeight;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    camera.updateProjectionMatrix();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                renderer.setSize(window.innerWidth, window.innerHeight);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </html>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            